
server {
        listen       80;
        server_name img.dev.ifchange.com img1.dev.ifchange.com img2.dev.ifchange.com img3.dev.ifchange.com;
        root   /opt/wwwroot/fe/static/;
        index  index.html;
        location /tob/ {
             alias  /opt/wwwroot/tob/web/fe/src/;
        }

        location /2b/ {
                alias  /opt/wwwroot/fe/static/2b/;
        }

        location /public/common/ {
                alias /opt/wwwroot/f2e/common/src/;
        }

        location /public/ {
                alias /opt/wwwroot/f2e/public/;
        }

        location /origin/ {
            alias  /opt/wwwroot/tob/web/fe/static/;
        }

        location / {
            alias  /opt/wwwroot/tob/web/fe/assets/;
        }
}

server {
        listen       80;
        server_name  dev.tob.ifchange.com;
        root   /opt/wwwroot/tob/web/be/;
        index  index.html index.htm index.php;
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }


        location ~ ^(.+\.php)(.*)$ {
        alias              /opt/wwwroot/tob/web/be/;
        fastcgi_pass unix:/run/php/php5.6-fpm.sock;
       # fastcgi_pass 127.0.0.1:9000;
        fastcgi_index   index.php;
        fastcgi_split_path_info         ^(.+\.php)(.*)$;
        fastcgi_param       PATH_INFO                $fastcgi_path_info;
        fastcgi_param       PATH_TRANSLATED        $DOCUMENT_ROOT$fastcgi_path_info;
        fastcgi_param       SCRIPT_FILENAME  $DOCUMENT_ROOT/$fastcgi_script_name;
        include             fastcgi_params;
        }

        location ~ ^(/_/.+\.html)$ {
            proxy_pass http://127.0.0.1:2521;
        }

        location ~ /.+\.(html|css|js|jpg|jpeg|gif|png|swf)$ {
            root /opt/wwwroot/tob/web/fe/src/views;
        }

      location ~* ^(/_|/socket\.io)(\/.*)*$ {
#        location ~* ^(/_|/api|/socket\.io)(\/.*)*$ {
            proxy_pass http://127.0.0.1:2521;
            proxy_redirect default;
            proxy_set_header  Host             $host;
            proxy_set_header  X-Real-IP        $remote_addr;
            proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }


        location / {
            rewrite ^(.*)$ /index.php/$1 last;
            #rewrite ^/(?!index\.php|proxy\.html|css|crossdomain\.xml|javascript|themes|home.php|intro.html|data|images|tmp|robots\.txt|\.ico)(.*)$ /index.php/$1 last;
        }
}


server {
        listen       80;
        server_name  dev.cor.ifchange.com;
        root   /opt/wwwroot/tob/web/corApiPlatform/;
        index  index.html index.htm index.php;
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }


        location ~ ^(.+\.php)(.*)$ {
        alias              /opt/wwwroot/tob/web/corApiPlatform/;
        fastcgi_pass unix:/run/php/php5.6-fpm.sock;
       # fastcgi_pass 127.0.0.1:9000;
        fastcgi_index   index.php;
        fastcgi_split_path_info         ^(.+\.php)(.*)$;
        fastcgi_param       PATH_INFO                $fastcgi_path_info;
        fastcgi_param       PATH_TRANSLATED        $DOCUMENT_ROOT$fastcgi_path_info;
        fastcgi_param       SCRIPT_FILENAME  $DOCUMENT_ROOT/$fastcgi_script_name;
        include             fastcgi_params;
        }

        location ~ ^(/_/.+\.html)$ {
            proxy_pass http://127.0.0.1:2521;
        }

        location ~ /.+\.(html|css|js|jpg|jpeg|gif|png|swf)$ {
            root /opt/wwwroot/tob/web/fe/src/views;
        }

      location ~* ^(/_|/socket\.io)(\/.*)*$ {
 #       location ~* ^(/_|/api|/socket\.io)(\/.*)*$ {
            proxy_pass http://127.0.0.1:2521;
            proxy_redirect default;
            proxy_set_header  Host             $host;
            proxy_set_header  X-Real-IP        $remote_addr;
            proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }


        location / {
            rewrite ^(.*)$ /index.php/$1 last;
            #rewrite ^/(?!index\.php|proxy\.html|css|crossdomain\.xml|javascript|themes|home.php|intro.html|data|images|tmp|robots\.txt|\.ico)(.*)$ /index.php/$1 last;
        }
}
